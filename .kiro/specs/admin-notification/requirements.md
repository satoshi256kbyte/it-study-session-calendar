# 管理者通知機能 要件定義書

## はじめに

この機能は、一般ユーザーが勉強会を登録した際に、管理者に自動的に通知を送信する機能です。現在、管理者は手動で管理画面をチェックして新しい登録を確認する必要がありますが、この機能により即座に新規登録を把握できるようになります。

## 要件

### 要件1: リアルタイム通知

**ユーザーストーリー:**
管理者として、新しい勉強会が登録されたときに即座に通知を受け取りたい。そうすることで、迅速に承認・却下の判断ができる。

#### 受入基準

1. WHEN 一般ユーザーが勉強会登録フォームを送信し、データベースに正常に保存された THEN システムは管理者に通知を送信する
2. WHEN 通知が送信される THEN 通知には勉強会のタイトル、開催日時、登録者の連絡先（提供されている場合）、詳細確認用のリンクが含まれる
3. WHEN 通知送信に失敗した THEN システムはエラーをログに記録し、勉強会登録処理は正常に完了する

### 要件2: SNS通知

**ユーザーストーリー:** 管理者として、Amazon
SNSを通じて通知を受け取りたい。そうすることで、管理画面にアクセスしていない時でも新規登録を把握でき、メール、SMS、Slackなど様々な方法で通知を受け取れる。

#### 受入基準

1. WHEN 新しい勉強会が登録される THEN システムは設定されたSNSトピックにメッセージを発行する
2. WHEN
   SNS通知を送信する THEN メッセージには勉強会のタイトル、開催日時、登録日時、管理画面へのリンクを含める
3. WHEN
   SNS通知を送信する THEN メッセージの件名は「【広島IT勉強会カレンダー】新しい勉強会が登録されました」の形式とする
4. WHEN
   SNSトピックにメッセージを発行する THEN 管理者が手動で設定したサブスクライバー（メール、SMS、Webhookなど）に通知が配信される

### 要件3: 管理画面内通知

**ユーザーストーリー:**
管理者として、管理画面にアクセスした際に未確認の新規登録があることを視覚的に把握したい。そうすることで、対応が必要な項目を見落とすことがない。

#### 受入基準

1. WHEN 管理者が管理画面にアクセスする THEN 承認待ちの勉強会数がヘッダーまたは目立つ場所に表示される
2. WHEN 承認待ちの勉強会がある THEN 該当する勉強会項目が視覚的に強調表示される
3. WHEN 承認待ちの勉強会が0件の場合 THEN 通知バッジは表示されない

### 要件4: 通知設定の管理

**ユーザーストーリー:**
システム管理者として、SNSトピックの設定や通知の有効/無効を設定できるようにしたい。そうすることで、運用に応じて柔軟に通知設定を変更できる。

#### 受入基準

1. WHEN システムを初期設定する THEN 環境変数またはパラメータストアでSNSトピックARNを設定できる
2. WHEN 通知機能を無効にしたい THEN 環境変数で通知機能のオン/オフを切り替えられる
3. WHEN 管理者が通知方法を変更したい THEN
   SNSコンソールで手動でサブスクライバー（メール、SMS、Webhookなど）を追加・削除できる

### 要件5: エラーハンドリング

**ユーザーストーリー:**
システム管理者として、通知送信に失敗した場合でも勉強会登録処理が正常に完了することを保証したい。そうすることで、通知システムの障害が本来の機能に影響しない。

#### 受入基準

1. WHEN メール送信サービスが利用できない THEN エラーをログに記録し、勉強会登録処理は正常に完了する
2. WHEN 通知送信処理でタイムアウトが発生する THEN 適切なタイムアウト時間（5秒以内）で処理を中断し、エラーログを記録する
3. WHEN 通知送信でエラーが発生する THEN エラーの詳細をCloudWatchログに記録し、監視可能にする

### 要件6: セキュリティとプライバシー

**ユーザーストーリー:**
システム管理者として、通知に含まれる情報が適切に保護されることを確保したい。そうすることで、登録者の個人情報が適切に扱われる。

#### 受入基準

1. WHEN メール通知を送信する THEN 通知には登録者の個人情報（連絡先）は含めず、管理画面でのみ確認できるようにする
2. WHEN 管理画面へのリンクを含める THEN リンクは認証が必要な管理画面へのリンクとし、直接データにアクセスできないようにする
3. WHEN 通知メールを送信する THEN メール送信はAWS SESなどのセキュアなサービスを使用する
